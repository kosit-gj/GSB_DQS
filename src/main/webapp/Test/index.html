

<script src="https://code.jquery.com/jquery-3.1.1.js"></script>

<script>

var restfulURL="http://192.168.1.37:3000";
	$(document).ready(function(){

		var checkUniqueFn = function(text){
			/* http://localhost:3000/api/products?name__regex=/^test/i */
			var unique=false;	
			$.ajax({
				url:restfulURL+"/api/products?name="+text+"",
				type:"get",
				dataType:"json",
				async:false,
				success:function(data){
					
					console.log(data);
					if(data==""){
						//alert("data empty");
						unique=true;
					}else{
						unique=false;
						//alert("full data");
					}
					
				}
			});
			return unique;
			
		}
		//console.log(checkUniqueFn("aa"));
		
		var validationFn = function(){
			
			var validateText="";
			if($("#name").val()==""){
				validateText+="name not empty\n";
			}
			if($("#sku").val()==""){
				validateText+="sku not empty\n";
			}
			if($("#price").val()==""){
				validateText+="price not empty\n";
			}
			
			 if(isNaN($("#price").val()))
			 {
				 validateText+="price is number only\n";
				
			 }
			
			if(validateText!=""){
				alert(validateText);
				return false;
			}else{
				return true;
			}
			
		}
		
		
		var insertFn = function(){

				$.ajax({
					url:restfulURL+"/api/products",
					type:"POST",
					dataType:"json",
					data:{"name":$("#name").val(),"sku":$("#sku").val(),"price":$("#price").val()},
					success:function(data,status){
						//alert(data);
						//console.log(data);
						console.log(status);
						if(status=="success"){
							alert("Insert Success");
							getDataFn();
							clearFn();
						}
					}
				});									

				return false;
			};

		var updateFn = function(){

			$.ajax({
				url:restfulURL+"/api/products/"+$("#id").val(),
				type:"PUT",
				dataType:"json",
				data:{"name":$("#name").val(),"sku":$("#sku").val(),"price":$("#price").val()},
				success:function(data,status){
					//alert(data);
					if(status=="success"){
						alert("Upate Success");
						getDataFn();
						clearFn();
					}
				}
			});

			return false;
		};

		var clearFn =function(){

			$("#id").val("");
			$("#action").val("add");
			$("#name").val("");
			$("#sku").val("");
			$("#price").val("");
			$("#btnSubmit").val("Add");

		}

		var findOneFn = function(id){
			//http://localhost:3000/find-user/58035b7cb4566c158bcecacf
			$.ajax({
				url:restfulURL+"/api/products/"+id,
				type:"get",
				dataType:"json",
				success:function(data){

						$("#name").val(data['name']);
						$("#sku").val(data['sku']);
						$("#price").val(data['price']);
						
				}
			});
		};
		
		var searchFn = function(searchText){
			/* http://localhost:3000/api/products?name__regex=/^test/i */
				
			$.ajax({
				url:restfulURL+"/api/products/?name__regex=/^"+searchText+"/i",
				type:"get",
				dataType:"json",
				success:function(data){

					listDataFn(data);
				}
			});
			
		}
		
		var listDataFn = function(data){

			console.log(data);
			var htmlTable="";
			$.each(data,function(index,indexEntry){
				//console.log(indexEntry);
					htmlTable+="<tr >";
						htmlTable+="<td>"+(index+1)+"</td>";
						htmlTable+="<td>"+indexEntry["name"]+"</td>";
						htmlTable+="<td>"+indexEntry["sku"]+"</td>";
						htmlTable+="<td>"+indexEntry["price"]+"</td>";
			
						htmlTable+="<td><button id="+indexEntry["_id"]+" class=\"edit\">Edit</button> &nbsp; <button id="+indexEntry["_id"]+" class=\"del\">Del</button></td>";
					htmlTable+="</tr>";
			});

			$("#listProducts").html(htmlTable);
			
			

			$(".del").click(function(){
				//alert(this.id);
				if(confirm("Do you want to delete this file?")){
					
					$.ajax({
						url:restfulURL+"/api/products/"+this.id,
						type:"delete",
						dataType:"json",
						//data:{"_id":this.id},
						success:function(data){							
							
							getDataFn();
							clearFn();

						}
					});
				}

			});

			//findOnd
			$(".edit").click(function(){

				findOneFn(this.id);
				$("#id").val(this.id);
				$("#action").val("edit");
				$("#btnSubmit").val("Edit");

			});
		}
		
		var getDataFn = function(){
			
			$.ajax({
				url:restfulURL+"/api/products",
				type:"get",
				dataType:"json",
				success:function(data){
					
					listDataFn(data);
				}
			});

		};
		
		
		//Call Function start
		getDataFn();

		$("#btnSubmit").click(function(){
			//alert($("#fullname").val());
			//alert($("#age").val());
			//alert($("#action").val());
			
			if(validationFn()==true){

				if($("#action").val()=="add" || $("#action").val()=="" ){
					
					if(checkUniqueFn($("#name").val())==true){
						insertFn();
					}else{
						alert("name is not unique.");
					}
						
				}else{
					updateFn();
				}
					
				
			}
			return false;

		});


		$("#btnSearch").click(function(){
			
			searchFn($("#searchText").val());
			return false;

		});

		$("#btnCancle").click(function(){

			clearFn();
			return false;

		});
		
		//Call Function End
		
	});
</script>

<input type="text" name="searchText" id="searchText" value=""><button id="btnSearch"> Search</button>
<table border="1">
<thead>
	<tr>
		<th><b>Seq</b></th>
		<th><b>Product Name</b></th>
		<th><b>SKU</b></th>
		<th><b>PRICE</b></th>
		<th><b>Action</b></th>
	</tr>
</thead>
<tbody id="listProducts">
	
</tbody>
</table>


<form action="#" method="post">
<table>
	<tr>
		<td>
			Product Name
		</td>
		<td>
			<input type="text" name="name" id="name">
		</td>

	</tr>
	
	
	<tr>
		<td>
			SKU
		</td>
		<td>
			<input type="text" name="sku" id="sku">
		</td>

	</tr>
	
	<tr>
		<td>
			Price
		</td>
		<td>
			<input type="text" name="price" id="price">
		</td>

	</tr>
	
	<tr>
		
		<td colspan="2">
			<input type="hidden" name="id" id="id" value="">
			<input type="hidden" name="action" id="action" value="add">
			<input type="button" name="btnSubmit" id="btnSubmit" value="Add">
			<button id="btnCancle">Cancel</button>
		</td>

	</tr>

</table>
</form>